apiVersion: trafficcontrol.policy.gloo.solo.io/v2
kind: TransformationPolicy
metadata:
  name: extract-pseudo-path-header
  namespace: httpbin
spec:
  applyToRoutes:
  - route:
      labels:
        extract-header: "pseudo-path"
  config:
    phase:
      preAuthz:
        priority: 1
    request:
      injaTemplate:
        # what to extract
        extractors:
          pseudo-path:
            header: :path
            regex: ([^?]+)?.*
            subgroup: 1
        # what to add/replace
        headers:
          custom-extracted-header:
            text: "{{ pseudo-path }}"