apiVersion: security.policy.gloo.solo.io/v2
kind: ExtAuthPolicy
metadata:
  name: httpbin-keycloak
  namespace: httpbin
spec:
  applyToRoutes:
    - route:
        labels:
          keycloak-oauth: 'true'
  config:
    glooAuth:
      configs:
        - oauth2:
            oidcAuthorizationCode:
              appUrl: 'https://httpbin-keycloak.glooplatform.com'
              callbackPath: /callback
              clientId: b80003ce-c0ed-4e38-a8c1-cbb09d207e00
              clientSecretRef:
                name: keycloak-client-secret
                namespace: gloo-mesh
              headers:
                idTokenHeader: Jwt
              issuerUrl: 'http://35.229.63.244:9000/auth/realms/master/'
              logoutPath: /logout
              scopes:
                - email
              session:
                cookieOptions:
                  maxAge: "3600"
                failOnFetchFailure: true
                redis:
                  allowRefreshing: true
                  cookieName: keycloak-session
                  options:
                    host: 'redis.gloo-mesh-addons:6379'
    server:
      cluster: mgmt
      name: mgmt-ext-auth-server
      namespace: gloo-mesh
