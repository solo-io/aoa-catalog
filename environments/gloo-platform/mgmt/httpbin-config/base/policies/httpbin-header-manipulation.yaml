apiVersion: trafficcontrol.policy.gloo.solo.io/v2
kind: TransformationPolicy
metadata:
  name: mtls-transformation
  namespace: httpbin
spec:
  applyToRoutes:
  - route:
      labels:
        transform-header: "pseudo-path"
  config:
    phase:
      preAuthz:
        priority: 1
    request:
      injaTemplate:
        # what to extract
        extractors:
          path:
            header: :path
            regex: ([^?]+)?.*
            subgroup: 1
        # what to add/replace
        headers:
          foo:
            text: "{{ path }}"