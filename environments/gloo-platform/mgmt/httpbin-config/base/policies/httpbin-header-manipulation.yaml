apiVersion: trafficcontrol.policy.gloo.solo.io/v2
kind: TransformationPolicy
metadata:
  name: mtls-transformation
  namespace: httpbin
spec:
  applyToRoutes:
  - route:
      labels:
        transform-header: "x-forwarded-client-cert"
  config:
    phase:
      preAuthz:
        priority: 1
    request:
      injaTemplate:
        # what to extract
        extractors:
          cert:
            header: "x-forwarded-client-cert"
            regex: '.*'
            subgroup: 0
        # what to add/replace
        headers:
          mtls-cert:
            text: "{{ cert }}"