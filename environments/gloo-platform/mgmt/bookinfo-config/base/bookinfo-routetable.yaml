apiVersion: networking.gloo.solo.io/v2
kind: RouteTable
metadata:
  name: productpage-rt-443
  namespace: bookinfo-team-config
spec:
  hosts:
  - 'bookinfo.east.glooplatform.com'
  http:
  - name: productpage-v1
    forwardTo:
      destinations:
      - kind: VIRTUAL_DESTINATION
        port:
          number: 9080
        ref:
          name: productpage-443
          namespace: bookinfo-team-config
        subset:
          version: v1
    labels:
      route: "productpage"
      waf: "true"
      oauth: "true"
    matchers:
    - uri:
        exact: /productpage
    - uri:
        prefix: /static
    - uri:
        exact: /login
    - uri:
        exact: /logout
    - uri:
        prefix: /api/v1/products
    - uri:
        prefix: /callback
  # Routes all /reviews requests to the reviews-v1 or reviews-v2 apps
  - name: reviews-v1
    labels: 
      route: reviews-v1
    matchers:
    - uri:
        prefix: /reviews/1
    forwardTo:
      destinations:
      - kind: VIRTUAL_DESTINATION
        port:
          number: 9080
        ref:
          name: reviews-vd
          namespace: bookinfo-team-config
        subset:
          version: v1
  - name: reviews-v2
    labels: 
      route: reviews-v2
    matchers:
    - uri:
        prefix: /reviews/2
    forwardTo:
      destinations:
      - kind: VIRTUAL_DESTINATION
        port:
          number: 9080
        ref:
          name: reviews-vd
          namespace: bookinfo-team-config
        subset:
          version: v2
  virtualGateways:
  - cluster: mgmt
    name: north-south-gw
    namespace: istio-gateways
  workloadSelectors: []