# kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# list of resources to be Applied
resources:
- ../base

transformers:
- label-transformer.yaml
- suffix-transformer.yaml

patches:
- target:
    group: networking.gloo.solo.io
    version: v2
    kind: RouteTable
    name: podinfo-main
  patch: |-
    - op: replace
      path: /spec/hosts/0
      value: podinfo-portal.glooplatform.com

# portal metadata patch      
- target:
    group: networking.gloo.solo.io
    version: v2
    kind: RouteTable
    name: v1-podinfo-rt
  patch: |-
    - op: replace
      path: /spec/portalMetadata/apiVersion
      value: v1-prod
    - op: replace
      path: /spec/http/0/forwardTo/destinations/0/ref/namespace
      value: podinfo-prod

# portal metadata patch      
- target:
    group: networking.gloo.solo.io
    version: v2
    kind: RouteTable
    name: v2-podinfo-rt
  patch: |-
    - op: replace
      path: /spec/portalMetadata/apiVersion
      value: v2-prod
    - op: replace
      path: /spec/http/0/forwardTo/destinations/0/ref/namespace
      value: podinfo-prod

namespace: podinfo-prod