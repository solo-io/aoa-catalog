apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: productpage-api-v1
  namespace: bookinfo
spec:
  rules:
    # dark launch reviews v2 to preview users
    - matches:
      - path:
          type: PathPrefix
          value: /reviews/2
        headers:
        - type: Exact
          name: user
          value: preview
      # Route to the productpage service
      backendRefs:
        - name: reviews
          port: 9080
    - matches:
      - path:
          type: PathPrefix
          value: /
      # Route to the productpage service
      backendRefs:
        - name: productpage
          port: 9080