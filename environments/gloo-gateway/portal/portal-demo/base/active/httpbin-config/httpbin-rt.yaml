apiVersion: networking.gloo.solo.io/v2
kind: RouteTable
metadata:
  name: httpbin-rt
  namespace: httpbin
  labels:
     portal: dev-portal
     api: httpbin
     # uncomment if you want to hide this API from the portal
     #portal-visibility: private
spec:
  # workaround for 2.3.4 try-it-now is to add https:// in the host
  hosts:
    - 'https://httpbin-local.glootest.com'
    - httpbin-local.glootest.com
  virtualGateways:
    - name: mgmt-north-south-gw-443
      namespace: istio-gateways
      cluster: mgmt
  portalMetadata:
    title: httpbin REST API
    description: REST API for httpbin to retrieve data for httpbin, authors and modules.
  http:
  - name: httpbin-api
    labels:
      usagePlans: dev-portal
    matchers:
    - uri:
        prefix: /
    forwardTo:
      pathRewrite: /
      # uncomment to use direct ref
      #destinations:
      #- ref:
      #    name: httpbin
      #    namespace: httpbin
      #  port:
      #    number: 8000
      # uncomment to use virtual destination
      destinations:
      - ref:
          name: httpbin-vd
          namespace: httpbin
        kind: VIRTUAL_DESTINATION
        port:
          number: 8000